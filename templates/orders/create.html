{% extends 'base.html' %}

{% block title %}Yangi buyurtma yaratish - AYDIN AWLAD CRM{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="bi bi-plus-circle me-2"></i>
        Yangi buyurtma yaratish
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'orders:list' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>
            Orqaga
        </a>
    </div>
</div>

<!-- Form -->
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard me-2"></i>
                    Buyurtma ma'lumotlari
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Mijoz -->
                    <div class="mb-3">
                        <label for="{{ form.customer.id_for_label }}" class="form-label">
                            <i class="bi bi-person me-1"></i>
                            {{ form.customer.label }} <span class="text-danger">*</span>
                        </label>
                        {{ form.customer }}
                        {% if form.customer.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.customer.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Buyurtma beruvchi mijozni tanlang
                        </div>
                    </div>

                    <!-- Manzil -->
                    <div class="mb-3">
                        <label for="{{ form.address.id_for_label }}" class="form-label">
                            <i class="bi bi-geo-alt me-1"></i>
                            {{ form.address.label }} <span class="text-danger">*</span>
                        </label>
                        {{ form.address }}
                        {% if form.address.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.address.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Jalyuzi o'rnatilishi kerak bo'lgan aniq manzil
                        </div>
                    </div>

                    <!-- Izohlar -->
                    <div class="mb-3">
                        <label for="{{ form.notes.id_for_label }}" class="form-label">
                            <i class="bi bi-chat-text me-1"></i>
                            {{ form.notes.label }}
                        </label>
                        {{ form.notes }}
                        {% if form.notes.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.notes.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">
                            Qo'shimcha izohlar yoki talablar (ixtiyoriy)
                        </div>
                    </div>

                    <!-- Submit buttons -->
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'orders:list' %}" class="btn btn-secondary">
                            <i class="bi bi-x-circle me-1"></i>
                            Bekor qilish
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i>
                            Buyurtma yaratish
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Yordamchi ma'lumotlar -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    Ma'lumot
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-info" role="alert">
                    <h6 class="alert-heading">
                        <i class="bi bi-lightbulb me-1"></i>
                        Eslatma
                    </h6>
                    <p class="mb-2">Yangi buyurtma yaratgandan keyin:</p>
                    <ul class="mb-0">
                        <li>Buyurtma avtomatik ravishda <strong>"O'lchovda"</strong> holatiga o'tadi</li>
                        <li>Texnik xodimni tayinlab, o'lchov olishni boshlashingiz mumkin</li>
                        <li>O'lchov olingandan keyin jalyuzi detallarini kiritasiz</li>
                    </ul>
                </div>

                <div class="list-group">
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">1. Buyurtma yaratish</h6>
                            <span class="badge bg-primary">Joriy</span>
                        </div>
                        <p class="mb-1">Mijoz va manzil ma'lumotlari</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">2. O'lchov olish</h6>
                            <span class="badge bg-secondary">Keyingi</span>
                        </div>
                        <p class="mb-1">Texnik xodim tayinlash va o'lchov</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">3. Ishlab chiqarish</h6>
                            <span class="badge bg-secondary">Keyingi</span>
                        </div>
                        <p class="mb-1">Jalyuzi ishlab chiqarish</p>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">4. O'rnatish</h6>
                            <span class="badge bg-secondary">Oxirgi</span>
                        </div>
                        <p class="mb-1">Jalyuzi o'rnatish va yakunlash</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mijoz qo'shish havolasi -->
        <div class="card mt-3">
            <div class="card-body text-center">
                <h6>Mijoz ro'yxatda yo'qmi?</h6>
                <a href="{% url 'customers:add' %}" class="btn btn-outline-success btn-sm">
                    <i class="bi bi-person-plus me-1"></i>
                    Yangi mijoz qo'shish
                </a>
            </div>
        </div>
    </div>
</div>

<script>
// Mijoz tanlanganda manzilini avtomatik to'ldirish (ixtiyoriy)
document.getElementById('{{ form.customer.id_for_label }}').addEventListener('change', function() {
    // Bu yerda AJAX orqali mijozning manzilini olish va address field'ga to'ldirish mumkin
    console.log('Mijoz tanlandi:', this.value);
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const customer = document.getElementById('{{ form.customer.id_for_label }}').value;
    const address = document.getElementById('{{ form.address.id_for_label }}').value;
    
    if (!customer) {
        e.preventDefault();
        alert('Mijozni tanlash majburiy!');
        return false;
    }
    
    if (!address.trim()) {
        e.preventDefault();
        alert('Manzilni kiritish majburiy!');
        return false;
    }
});
</script>
{% endblock %}